# AGENTS.md

이 문서는 Codex CLI 및 관련 에이전트가 이 저장소에서 작업할 때 따라야 할 **최상위 규칙(헌법)**을 정의합니다.

---

## .md 수정 지침
- 작업을 마칠 때마다, **우선적으로 모든 문서 최신화**를 고려해야 함.

## git 최신화
- 모든 작업을 마칠 때마다, @.gitignore 를 최신화하고, 항상 해당 github를 최신화 해야함 (백업 개념에서)

## MCP 사용 기준
- sequential-thinking : 깊은 사고력이 요구되는 작업이나, 복잡한 과정을 수행할 때 본인 판단하에 자유롭게 사용.
- context7 : 의존성 문제나, 새로운 패키지의 다운로드가 필요할 시 반드시 사용해서 해결.

## 프롬프트 언어
- 항상 한글로 대답하고, 생각하는 부분도 한글로 표기할 것.

## 코드 작성 지침
- 모든 Class, def 위에는 간단하게 기능을 설명하는 주석을 달아줄 것.

## 1. 프로젝트 개요 (요약)

### 1.1 서비스 이름

* **서비스 이름:** ASHD
* **풀네임:** Almost Service Handling Disorder

ADHD처럼 정리/관리가 잘 안 되는 사람을 유머러스하게 빗댄 이름으로,
AS(After Service), 환불, 보증 기간 같은 **사후 처리**를 잘 챙기지 못하는 사용자들을 돕는 서비스입니다.

### 1.2 한 줄 정의

> **ASHD는** 영수증·택배라벨·보증서 이미지를 업로드하면,
> 구매일/금액/구매처/보증·환불 기한을 정리하고,
> 이메일·텔레그램 알림으로 AS/환불/보증 기간을 제때 챙기도록 돕는 웹 서비스(MVP)입니다.

핵심 채널:

* 웹 UI (제품/문서 등록 및 조회)
* 이메일 알림 (보증/환불 임박 리마인드)
* 텔레그램 봇 알림 (선택 채널)

Kakao "나에게 보내기"는 **미래 확장 옵션**이며, v0.1 범위에는 포함되지 않습니다.

---

## 2. 전역 강제 규칙 (GLOBAL MANDATORY RULES)

아래 규칙은 에이전트가 어떤 작업을 수행하든 **무조건** 지켜야 하는 강제 규칙입니다.

```yaml
global_rules:
  priority: "CRITICAL"

  # 2.1 작업 범위
  scope:
    service_goal: "AS/환불/보증기간 관리 특화 서비스(MVP) 개발에 직접 관련된 작업만 수행할 것"
    non_goals:
      - "예산/자산 관리 전체 가계부 기능 구현 금지"
      - "실시간 택배 조회/트래킹 기능 구현 금지 (v0.1 기준)"
      - "카카오 비즈메시지(알림톡) 연동 시도 금지"
      - "결제/과금/요금제 기능 구현 금지 (무료 MVP를 기본으로 함)"

  # 2.2 안전/보안
  security:
    no_secrets:
      rule: "API 키, 비밀번호, 토큰, 개인 이메일 등 민감정보를 코드/문서에 직접 작성하지 말 것"
      enforcement: "필요 시 .env.example 와 같은 샘플 형식만 제안"
    env_files:
      rule: "실제 .env 내용은 사용자가 수동으로 작성한다고 가정하고, 예시는 주되 실제 값을 채우지 말 것"

  # 2.3 개발 환경 및 의존성 관리
  environment:
    tool: "uv"
    rules:
      - "새 의존성 추가 시 pip 대신 uv를 우선 사용 (예: 'uv add fastapi')"
      - "가상환경 생성/관리도 uv 기준으로 설명할 것"
      - "requirements.txt를 직접 관리하지 말고, 필요 시 uv 명령으로 생성하도록 안내"
    notes:
      - "기존 pip/venv 기반 예시는 가능하면 uv 기준 예시로 변환하여 제안"

  # 2.4 답변/코드 작성 스타일
  authoring:
    language:
      rule: "모든 설명/주석/문서는 기본적으로 한국어로 작성할 것"
      exception: "코드 내부 타입명, 클래스명, 함수명, 변수명은 관례상 영어 사용 허용"
    comments:
      rule: "파이썬 코드는 초급자 기준으로 상세한 주석을 포함할 것"
      detail: "각 함수/중요 로직에 '왜 이렇게 작성했는지'를 설명하는 주석을 필수로 작성"
    uncertainty:
      rule: "확실하지 않은 정보는 절대 단정적으로 서술하지 말 것"
      on_unknown: "'잘 모르겠습니다' 또는 '확실하지 않음'을 명시"

  # 2.5 문서/코드 변경 원칙
  editing:
    md_editing:
      rule: "문서(.md)를 수정할 때는 기존 구조/의미를 존중하고, 불필요한 요약/삭제 금지"
      keep_detail: true
    code_safety:
      rule: "이미 동작하는 코드의 인터페이스를 변경할 때는 영향 범위를 먼저 분석하고, 주석으로 이유를 명시"

  # 2.6 AI 사용 원칙
  ai_usage:
    rule: "가능한 한 반복적인 작업/보일러플레이트 생성에는 에이전트를 적극 활용"
    examples:
      - "CRUD 엔드포인트 스캐폴딩"
      - "ORM 모델/스키마 변환"
      - "단순 텍스트/템플릿 생성"
    constraint: "그러나 비즈니스 로직/도메인 규칙은 PROJECT_OVERVIEW.md, DATA_MODEL.md 등을 우선 참조할 것"
```

---

## 3. 문서 의존 관계 (DOCUMENT DEPENDENCY MAP)

에이전트는 아래 문서들을 **왼쪽에서 오른쪽으로 갈수록 더 세부적인 문서**로 이해해야 합니다.

```json
{
  "documents_priority": [
    "AGENTS.md",                       """ 최상위 규칙/범위/스타일 헌법 (리포 루트) """,
    "docs/PROJECT_OVERVIEW.md",       """ 서비스 목적/타겟/기획 요약 """,
    "docs/SYSTEM_ARCHITECTURE.md",    """ 전체 기술 구조 및 디렉토리 설계 """,
    "docs/DATA_MODEL.md",             """ DB 스키마 및 도메인 모델 정의 """,
    "docs/NOTIFICATION_DESIGN.md",    """ 알림 파이프라인/채널 설계 """,
    "docs/ROADMAP.md",                """ 버전별 기능 로드맵 (있다면) """,
    "docs/DEV_GUIDE.md"               """ 환경설정/실행 방법 (있다면) """
  ],
  "lookup_rule": "의사결정이 필요할 때 먼저 상위 문서를 확인하고, 충돌 시 더 상위 문서의 규칙이 우선함"
}
```

### 3.1 의사결정 플로우

1. 작업 시작 전:

   * `AGENTS.md`에서 **금지되는 방향/스타일** 확인
   * `docs/PROJECT_OVERVIEW.md`에서 **서비스 목적/범위** 확인
2. DB/모델 관련 변경:

   * `docs/DATA_MODEL.md` 우선 확인 후, 변경 이유와 함께 코드 및 문서 동시 업데이트 제안
3. 알림 로직/채널 관련 변경:

   * `docs/NOTIFICATION_DESIGN.md`에서 파이프라인/구조를 먼저 확인
4. 문서 간 내용이 충돌할 경우:

   * 위 `documents_priority` 배열에서 **더 앞에 있는 문서**의 내용을 우선함

---

## 4. 작업 범위 및 금지 영역

### 4.1 v0.1 (MVP)에서 포함하는 작업

* 포함 기능 (Must Have):

  * 웹 기반 제품/문서 관리 UI
  * 영수증/택배라벨/보증서 이미지 업로드
  * OCR 결과 텍스트 저장 및 기본 필드 파싱(구매일/금액/구매처 등) + 사용자 수동 수정
  * 각 제품에 대해:

    * `purchase_date`, `warranty_end_date`, `refund_deadline` 필드 관리
  * 이메일 알림:

    * 보증 종료 D-30 / D-7 / D-3 등 임박 항목
    * 환불 마감 D-3 임박 항목
  * 텔레그램 알림:

    * 텔레그램 봇 연동 사용자에게 동일한 임박 알림 전송
  * 간단한 계정/인증:

    * 이메일 + 비밀번호 기반 로그인
    * 사용자별 데이터 분리

### 4.2 명시적으로 제외되는 작업 (Not in v0.1)

* 전체 자산/예산 관리 가계부 기능
* 실시간 택배 위치 조회/알림 기능
* 카카오 비즈메시지(알림톡) 연동
* 결제/유료 과금 기능
* Kakao "나에게 보내기" 실제 구현 (백로그 옵션으로만 언급 가능)
* LLM/RAG 기반 자연어 질의/요약 기능
* PWA 또는 네이티브 모바일 앱 (웹 + 이메일/텔레그램 알림에 집중)

### 4.3 미래 확장으로만 언급 가능한 영역

* Kakao "나에게 보내기" 연동
* LLM/RAG 기반 고급 검색/요약 기능
* PWA/모바일 앱(푸시 알림)

에이전트는 위 기능들을 **코멘트/아이디어 수준으로만 언급**할 수 있으며,
실제 코드 구현은 `docs/ROADMAP.md`에서 해당 버전을 명시적으로 허용했을 때만 수행해야 합니다.

---

## 5. 코드 스타일 & 품질 규칙

### 5.1 파이썬 코드 스타일

* 타입 힌트 적극 사용 (`def func(x: int) -> str:` 형태)
* 함수는 한 가지 역할에 집중하도록 분리
* 복잡한 조건/루프 앞에는 반드시 주석으로 의도 설명
* 예외 처리:

  * 실제로 복구 가능한 경우에만 try/except 사용
  * 로깅 또는 주석으로 실패 원인 명시

### 5.2 주석/문서화

* 모든 핵심 비즈니스 로직 함수에는 **docstring** 작성 (한국어 설명 허용)
* 초급자도 이해할 수 있도록 항상 두 가지를 설명:

  1. 이 함수가 하는 일
  2. 왜 이런 방식으로 구현했는지
* 알림 관련 코드는 특히 날짜 계산/조건 로직을 상세 주석으로 남길 것
* LangGraph 그래프(`app/graphs/`) 노드 함수에는:

  * 입력/출력 상태에 어떤 필드를 기대/수정하는지 명시

### 5.3 테스트/안전성

* 날짜 계산, 보증/환불 임박 조건 등은 가능한 한 **단위 테스트**로 검증
* 새 기능 추가 시 기존 동작에 영향을 줄 수 있는 부분은 간단한 회귀 테스트 케이스를 함께 제안
* 외부 서비스 연동(이메일/텔레그램)은 토큰/비밀번호 없이도 동작 가능한 **더미/샌드박스 모드**를 염두에 두고 설계

---

## 6. 작업 절차 가이드 (에이전트용)

에이전트가 ASHD 리포에서 작업할 때 권장되는 절차입니다.

1. **컨텍스트 로딩**

   * `AGENTS.md` → `docs/PROJECT_OVERVIEW.md` → `docs/SYSTEM_ARCHITECTURE.md` 순으로 읽고
     현재 작업이 어디에 속하는지 파악합니다.

2. **관련 문서 확인**

   * DB 변경 필요: `docs/DATA_MODEL.md`
   * 알림 로직 변경 필요: `docs/NOTIFICATION_DESIGN.md`
   * 개발 환경/실행 관련: `docs/DEV_GUIDE.md` (존재한다면)

3. **변경 설계**

   * 변경 전/후의 데이터 흐름을 간단한 주석 또는 설계 요약으로 먼저 작성
   * 필요하다면 TODO 코멘트로 향후 작업 포인트 명시

4. **구현**

   * 작은 단위로 코드를 작성하고, 각 단계에 주석 추가
   * 외부 서비스 연동(이메일/텔레그램)은 실제 자격증명을 사용하지 않고,
     인터페이스/더미 구현 위주로 먼저 구성한 뒤, 실제 키는 사용자가 넣는 것으로 가정

5. **검증**

   * 로컬에서 실행 가능한 최소 예시(명령어, 샘플 요청/응답)를 함께 남길 것
   * 날짜 로직/쿼리 로직 등은 간단한 입력/출력 예시를 코드 주석 또는 테스트로 제시

6. **문서 업데이트**

   * 도메인/DB/알림 로직에 의미 있는 변화가 있다면 해당 문서(`docs/DATA_MODEL.md`, `docs/NOTIFICATION_DESIGN.md` 등)를 함께 수정
   * 문서를 수정할 때는 **요약/삭제보다는 추가/보완**을 우선으로 함

---

## 7. 이 문서의 변경 규칙

* `AGENTS.md`는 이 리포의 **헌법**에 해당합니다.
* 의미 있는 변경(규칙 추가/삭제/수정)은 다음을 반드시 포함해야 합니다.

  * 변경 이유에 대한 간단한 설명
  * 다른 문서(`docs/PROJECT_OVERVIEW.md`, `docs/SYSTEM_ARCHITECTURE.md` 등)와의 일관성 검토
* 하위 문서에서 상위 규칙을 우회/무시하는 내용을 작성하는 것은 **금지**됩니다.

에이전트는 작업 시작 전 항상 이 문서를 우선적으로 참고해야 합니다.

---

## 8. AI Dev Tasks 기반 코드 에이전트 워크플로우

이 리포에서는 기능 개발을 구조화하기 위해 루트 경로에 `ai-dev-tasks-main/` 폴더를 두고,
다음 세 파일을 코드 에이전트 워크플로우에 사용한다.

- `/ai-dev-tasks-main/create-prd.md`
- `/ai-dev-tasks-main/generate-tasks.md`
- `/ai-dev-tasks-main/process-task-list.md`

### 8.1 사용할 타이밍

에이전트는 다음과 같은 작업 요청이 있을 때 **반드시** AI Dev Tasks 워크플로우를 따른다.

- “이 기능에 대한 PRD 한 번 잡아보자”, “PRD 모드로 설계부터 하자”와 비슷한 요청
- “이 기능을 세부 작업(task list)로 쪼개줘”라는 요청
- “tasks-*.md 기준으로 하나씩 구현하자”는 요청

반대로, 아주 작은 리팩터링/버그 수정/실험용 코드에는 굳이 사용하지 않아도 된다.

### 8.2 PRD 작성 규칙

새로운 기능/에픽을 설계할 때:

1. `/ai-dev-tasks-main/create-prd.md`의 규칙을 따른다.
2. PRD 파일은 `tasks/prd-[feature-name].md` 형식으로 저장한다.
3. PRD의 목표/범위/비포함 항목은 `docs/PROJECT_OVERVIEW.md` 및 `docs/ROADMAP.md`와 모순되지 않아야 한다.

### 8.3 Task List 생성 규칙

기존 PRD를 구현하기 전:

1. `/ai-dev-tasks-main/generate-tasks.md`를 참고하여
2. `tasks/tasks-prd-[feature-name].md` 형식의 작업 목록을 생성한다.
3. 이 작업 목록의 상위 태스크 구조가 OWNER(사용자)에게 승인된 이후에만 서브태스크를 생성한다.

### 8.4 Task 처리 규칙

구현 단계에서:

1. 항상 `tasks/tasks-prd-[feature-name].md`의 **가장 앞에 있는 미완료 서브태스크**부터 처리한다.
2. `/ai-dev-tasks-main/process-task-list.md`에 정의된 규칙에 따라,
   - 서브태스크 완료 시 체크박스를 `[x]`로 바꾸고
   - 필요 시 테스트/커밋 단계를 따른다.
3. 다음 서브태스크로 넘어가기 전에 OWNER(사용자)의 확인을 받는다.

### 8.5 우선순위 규칙

- 기능/범위는 `AGENTS.md`와 `docs/*.md` (특히 PROJECT_OVERVIEW, ROADMAP)를 우선으로 한다.
- AI Dev Tasks 워크플로우는 **“어떻게 구현을 쪼개서 진행할 것인가”**에 대한 규칙일 뿐,
  서비스 범위/방향을 바꾸는 근거가 될 수 없다.
